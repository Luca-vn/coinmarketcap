<!DOCTYPE html>
<html>
<head>
    <title>Bot Action Chart - {{ asset.upper() }}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h2>Biá»ƒu Ä‘á»“ Bot Action: {{ asset.upper() }}</h2>
    <canvas id="botChart" width="1000" height="400"></canvas>

    <script>
        const labels = {{ timestamps|tojson }};
        const priceData = {{ price_pct|tojson }};
        const volumeData = {{ volume_pct|tojson }};
        const botActions = {{ bot_actions|tojson }};

        const pointStyles = [];
        const pointColors = [];

        let countGom = 0, countXa = 0, countGomAm = 0, countXaAm = 0, countTrap = 0;

        botActions.forEach(action => {
            if (action.includes("ðŸ”µ")) {
                pointStyles.push("circle");
                pointColors.push("green");
                countGom++;
            } else if (action.includes("ðŸ”´")) {
                pointStyles.push("rectRot");
                pointColors.push("red");
                countXa++;
            } else if (action.includes("ðŸŒ•")) {
                pointStyles.push("triangle");
                pointColors.push("gold");
                countGomAm++;
            } else if (action.includes("ðŸ”¥")) {
                pointStyles.push("cross");
                pointColors.push("black");
                countXaAm++;
            } else if (action.includes("ðŸŸ¡")) {
                pointStyles.push("star");
                pointColors.push("gray");
                countTrap++;
            } else {
                pointStyles.push("line");
                pointColors.push("blue");
            }
        });

        const ctx = document.getElementById('botChart').getContext('2d');
        const botChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '% Price Change',
                    data: priceData,
                    borderColor: 'blue',
                    backgroundColor: 'blue',
                    tension: 0.1,
                    pointStyle: pointStyles,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    pointBackgroundColor: pointColors
                }, {
                    label: '% Volume Change',
                    data: volumeData,
                    borderColor: 'orange',
                    backgroundColor: 'orange',
                    tension: 0.1,
                    borderDash: [5, 5],
                    pointRadius: 3
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            afterBody: function(context) {
                                let index = context[0].dataIndex;
                                return 'Bot Action: ' + botActions[index];
                            }
                        }
                    },
                    legend: {
                        position: 'top'
                    },
                    title: {
                        display: true,
                        text: 'PhÃ¢n tÃ­ch hÃ nh vi bot: ' + '{{ asset.upper() }}'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: '% Change'
                        }
                    }
                }
            }
        });

        // Hiá»ƒn thá»‹ thá»‘ng kÃª dÆ°á»›i chart
        document.write("<div style='margin-top:20px;'>");
        document.write("<b>Thá»‘ng kÃª hÃ nh vi bot:</b><br>");
        document.write("ðŸ”µ Gom máº¡nh: " + countGom + " láº§n<br>");
        document.write("ðŸ”´ Xáº£ máº¡nh: " + countXa + " láº§n<br>");
        document.write("ðŸŒ• Gom Ã¢m tháº§m: " + countGomAm + " láº§n<br>");
        document.write("ðŸ”¥ Xáº£ Ã¢m tháº§m: " + countXaAm + " láº§n<br>");
        document.write("ðŸŸ¡ Trap: " + countTrap + " láº§n<br>");
        document.write("</div>");
    </script>
</body>
</html>